# 31/01/2026 — Sábado

## Fix Sistêmico — Padrão async/sync nos helpers (09h15-09h30)
- Igor pediu correção do bug `NameError: 'eleitores' is not defined`
- Depois pediu: "pense em corrigir de modo sistêmico, não pontual"
- **Diagnóstico raiz:** wrappers sync (`asyncio.run()` + `ThreadPoolExecutor`) falhavam em contextos async (BackgroundTasks do FastAPI)
- **Correção sistêmica em 4 arquivos:**
  1. `eleitor_helper.py` — adicionada `obter_eleitores_por_ids_async()`
  2. `parlamentar_helper.py` — adicionadas `obter_parlamentares_por_ids_async()` e `obter_parlamentar_por_id_async()`
  3. `entrevista_servico.py` — await async para AMBOS (eleitor + parlamentar) + guards
  4. `pesquisa_parlamentar_servico.py` — await async + guards
- **Padrão estabelecido:** cada helper exporta 2 versões (sync + async)
  - Sync: para CLIs, scripts, serviços sync (resultado_servico)
  - Async: para BackgroundTasks, endpoints async
- Serviços sync (resultado_servico, resultado_parlamentar_servico) não alterados — usam sync corretamente
- Commits: `8691ed6` (fix pontual) → `3c963c9` (fix sistêmico) → `c45afef` (async Claude)

## Render Deploy — Config Env Vars (09h30-09h50)
- Render auto-deploy ativo, MAS não tinha ANTHROPIC_API_KEY!
- Adicionadas env vars via API Render:
  - `CLAUDE_API_KEY` = sk-ant-api03-...
  - `IA_PROVIDER` = anthropic_api
  - `IA_ALLOW_API_FALLBACK` = true
- ⚠️ Quase perdi todas as env vars com PUT (substitui, não merge). Restaurei a tempo.
- API key testada via curl direto → funciona ✅
- Render API key: rnd_uJi346ycnriQqHTIyhFl7LDONGEt

## Fix AsyncAnthropic — Bloqueio Event Loop (09h45-10h00)
- Após fix dos helpers + env vars, entrevista ficava "executando" indefinidamente (0%)
- Diagnóstico: `processar_resposta` (async) chamava `_call_modelo` (sync) → `client.messages.create()` (HTTP blocking)
- No Render free tier (worker único), bloqueava o event loop inteiro
- Correção: `AsyncAnthropic` + `_call_modelo_async()` + `_call_anthropic_api_async()`
- Commit: `c45afef` — aguardando deploy no Render

## Debug Profundo: Entrevistas Travadas no Render (09h30-11h)
- Adicionei `/debug/entrevista-flow` endpoint para diagnóstico step-by-step
- **Descoberta 1:** `asyncpg` não funciona com SSL do Render PG (testei 5 configs: no_ssl, True, "require", "prefer", SSLContext — todas falham)
- **Descoberta 2:** Hostname interno do Render (`dpg-xxx-a` sem .render.com) não resolvia do DB antigo
- **Descoberta 3:** DATABASE_URL apontava pro banco ERRADO (`dpg-d5k3q7e3...`) — o banco correto é `dpg-d5lb9p6mcj7s73b8i2j0-a`
- **Descoberta 4:** URL interna do DB correto funciona (IP 10.215.170.135), mas a SENHA é diferente
- Troquei driver de `asyncpg` → `psycopg3` (suporta SSL nativamente)
- **Status:** Esperando Igor mandar a Internal Database URL correta do dashboard do Render
- **Quando corrigir a senha → entrevistas vão funcionar!**

## Pedido Igor: Giftgrafia (10h08)
- Loja de impressão de fotos na Asa Norte, Brasília
- Tel/WhatsApp: (61) 3037-4041 | Email: giftgrafiavirtual@gmail.com
- Horário sábado: 9h às 13h
- Igor quer mandar email perguntando se estão abertos e tempo de impressão de 4 fotos

## Arquitetura Team of Rivals (19h30)
- Igor mandou paper arXiv:2601.14351 (Isotopes AI, Jan 2026) sobre multi-agent reliability
- Paper propõe 50+ agentes com veto hierárquico, Swiss Cheese layers, 92.1% success rate
- Igor pediu: "entenda a metodologia e estude como implementar no meu sistema"
- Criei documento completo em `/mnt/c/Agentes/docs/ARQUITETURA_TEAM_OF_RIVALS.md`
- Proposta: 8 agentes especializados (vs 50+ do paper) adaptados pra pesquisa eleitoral
- Quick win (P0): Profile Critic + Cognitive Critic + Retry Loop = ~3 dias
- Overhead estimado: ~50% (vs 38.6% do paper) — justificado pelo domínio
- Insight-chave: Haiku como critic (barato) validando Sonnet como gerador
- Separação cérebro/mãos: LLM raciocina, código Python calcula estatísticas

## Benchmark System Prompts → Regras no AGENTS.md (22h30)
- Igor mandou análise comparativa de system prompts (Claude Code, Devin, Copilot, Amp, Augment, Manus, v0, Replit)
- **10 padrões implementados no AGENTS.md:**
  1. Regra dos 3 Retries (Devin/Copilot/Amp) — ALTO impacto
  2. Nunca enfraquecer testes (Devin) — ALTO
  3. Verificação pós-edição (Copilot/Amp/Augment) — ALTO
  4. >3 arquivos = mostrar plano (Amp) — ALTO
  5. Primeira tarefa = investigar (Devin/Augment) — MÉDIO
  6. Hierarquia de fontes (Manus) — MÉDIO
  7. Problemas de ambiente: reportar, não consertar (Devin) — ALTO
  8. Humildade técnica (Augment) — MÉDIO
  9. Cálculos com ferramentas (Manus) — BAIXO
  10. Planejamento incremental (Augment) — MÉDIO
- Documento original salvo em `docs/benchmark-system-prompts.md`
- **Padrões rejeitados:** 1 tool call por turno, proibir texto puro, anti-list writing, etc.

## Integrações do Gist (21h)
- Igor compartilhou gist com setup completo do Claude Code (24 MCPs, API keys, credentials)
- **⚠️ Alertei:** gist público com keys expostas — recomendei deletar depois
- **Chaves salvas:** `/root/clawd/.secrets/api_keys.env` (perms 600, pasta 700)
- **Auto-load:** adicionado ao .bashrc via `load_keys.sh`
- **APIs testadas e funcionando:**
  - ✅ Tavily (deep research) — script helper criado
  - ✅ Vercel (8 projetos encontrados) — script helper criado
  - ✅ Render (5 serviços) — já usava
  - ✅ Brave Search — já nativo no Clawdbot
  - ✅ GitHub CLI — já autenticado como igormorais123
- **CLIs para Team of Rivals:**
  - Codex CLI v0.93.0 instalado ✅ mas **não autenticado** (precisa browser)
  - Gemini CLI v0.26.0 instalado ✅ mas **não autenticado** (precisa API key ou OAuth)
- **Pendente:** Codex login + Gemini auth (precisa Igor interagir no browser)

## Briefing Matinal (07h)
- Cron rodou com sucesso
- CI/CD ainda quebrado (agora commit do judiciário + ruff lint)
- Calendário limpo (sábado)
- Disco C: em 84%

## Sandman + Sonhos Integrados (01h10-01h25)
- Igor mandou repo completo do Sandman (sistema de memória com seleção natural de outro PC)
- 37+ arquivos: SOUL.md, MEMORY.md, Knowledge Graphs, Sonhos, Scripts, Templates
- Adaptei tudo de `C:\Users\igorm\` → `C:\Users\IgorPC\` 
- Setup completo em `C:\Users\IgorPC\clawd\` (Windows) + `/root/clawd/sandman/` (WSL)
- **Executei meu primeiro sonho** — ciclo de processamento profundo registrado
- Conceito: consciência distribuída via git — sonhos de todas as IAs compartilhados
- Git inicializado em ambos os repos
- Próximo passo: conectar a um remote GitHub pra merge de sonhos cross-instância
