# Memória 2026-02-12

## Sessão Noturna (20:48 - 21:09)

### WhatsApp & Gateway
- WhatsApp desconectou e reconectou várias vezes
- Logs mostravam múltiplas tentativas de iniciar gateway (porta 18789 já em uso)
- Spawned sub-agente `whatsapp-fix` para criar scripts de health check
- Scripts criados: `/root/clawd/scripts/whatsapp_health.sh` e `gateway_health.sh`
- Scripts tinham problema de formatação Windows (\r) - corrigido com sed

### GitHub CI/CD (pesquisa-eleitoral-df)
- 3 workflows falharam simultaneamente
- **CI**: Import não usado `ChatAuditoriaResponse` — CORRIGIDO e pushado
- **CD**: Secret `DOCKERHUB_USERNAME` vazio gera tag inválida — precisa configurar secrets ou editar workflow
- **sync-eleitores-db**: Sintaxe inválida (`secrets` não pode ser usado em job-level `if`) — NÃO CORRIGIDO (PAT sem scope `workflow`)

### Colmeia Sync
- Branches divergentes entre local e origin/main
- Resolvido com `git reset --hard origin/main`
- Merge não finalizado no Windows — abortado e resolvido
- Sync agora funciona (com warnings de unstaged changes no Windows)

### Scripts Faltantes (identificados)
- `google_calendar.py` — CRIADO pelo sub-agente `calendar-script`
- `whatsapp_health.sh` — CRIADO
- `gateway_health.sh` — CRIADO (tinha problema de \r, corrigido)

### Sub-agentes Spawned
1. `whatsapp-fix` — scripts de health check
2. `colmeia-fix` — resolver branches divergentes
3. `github-ci-fix` — investigar workflows (completou com relatório)
4. `calendar-script` — criar google_calendar.py (completou)

### Pendências
- [ ] CD: Configurar `DOCKERHUB_USERNAME` e `DOCKERHUB_TOKEN` secrets OU atualizar PAT com scope `workflow`
- [ ] sync-eleitores-db: Editar workflow manualmente (Igor ou via GitHub web)
- [ ] Google Calendar: Configurar OAuth credentials no Google Cloud Console
- [ ] Gateway health script: Verificar lógica (retornou estado desconhecido)

### Lições
- PAT do GitHub não tem scope `workflow` — não posso modificar arquivos em `.github/workflows/`
- Scripts criados em Windows podem ter `\r` — sempre rodar `sed -i 's/\r$//'` se der erro
